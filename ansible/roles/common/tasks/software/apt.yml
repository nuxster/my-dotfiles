---
- name: Configure APT
  become: true
  block:
    - name: Set APT options
      ansible.builtin.lineinfile:
        dest: "{{ apt_config_file }}"
        line: "{{ item }}"
        create: true
      loop: "{{ apt_options }}"

    - name: Set APT mirror
      ansible.builtin.template:
        src: sources_list.tmpl
        dest: /etc/apt/sources.list
        owner: root
        group: root
        mode: '0644'

    - name: Upgrade all packages
      ansible.builtin.apt:
        upgrade: dist
        update_cache: true
      when:
        - upgrade_packages
